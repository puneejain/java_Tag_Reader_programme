<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Tag Information  System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>


<style>
	body{background-image:url(https://wallpaperaccess.com/full/4475366.png) ;  }
		
	
	
	
	
</style>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">Information Management</h2>
        </div>
        <div class="card-body">
            <form action="/fastag" method="post" class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Tag ID</label>
                    <input type="text" name="tagId" class="form-control" placeholder="Enter Tag ID">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <input type="text" name="name" class="form-control" placeholder="Enter Name">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Reg No</label>
                    <input type="text" name="regNo" class="form-control" placeholder="Enter Vehicle Reg No">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Mobile</label>
                    <input type="text" name="mobileNumber" class="form-control" placeholder="Enter Mobile Number">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Unit No</label>
                    <input type="text" name="unitNo" class="form-control" placeholder="Enter Unit No">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Others</label>
                    <input type="text" name="others" class="form-control" placeholder="Additional Info">
                </div>

                <div class="d-flex justify-content-center gap-3 mt-4">
                    <button type="submit" name="action" value="store" class="btn btn-success">
                        Save Info
                    </button>
                    <button type="submit" name="action" value="show" class="btn btn-info text-white">
                         Scan Info
                    </button>
                    <button type="submit" name="action" value="report" class="btn btn-warning">
                         Report
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Show message -->
    <div th:if="${message}" class="alert alert-primary mt-4" th:text="${message}"></div>

    <!-- Show single record -->
 <!--   <div th:if="${fastag != null}" class="card mt-4 shadow-sm">
        <div class="card-header bg-info text-white">FASTag Info</div>
        <div class="card-body">
            <p><strong>Tag ID:</strong> <span th:text="${fastag.tagId}"></span></p>
            <p><strong>Name:</strong> <span th:text="${fastag.name}"></span></p>
            <p><strong>Reg No:</strong> <span th:text="${fastag.regNo}"></span></p>
            <p><strong>Mobile:</strong> <span th:text="${fastag.mobileNumber}"></span></p>
            <p><strong>Unit:</strong> <span th:text="${fastag.unitNo}"></span></p>
            <p><strong>Others:</strong> <span th:text="${fastag.others}"></span></p>
        </div>
    </div>-->
	<!-- Live Scan Result -->
	<div class="card mt-4 shadow-sm">
	    <div class="card-header bg-success text-white">Live Scanned FASTag</div>
	    <div class="card-body">
	        <p><strong>Tag ID:</strong> <span id="scanTagId">-</span></p>
	        <p><strong>Name:</strong> <span id="scanName">-</span></p>
	        <p><strong>Reg No:</strong> <span id="scanReg">-</span></p>
	        <p><strong>Mobile:</strong> <span id="scanMobile">-</span></p>
	        <p><strong>Unit:</strong> <span id="scanUnit">-</span></p>
	        <p><strong>Others:</strong> <span id="scanOther">-</span></p>
	    </div>
	</div>
    <!-- Show report -->
    <div th:if="${fastags != null}" class="card mt-4 shadow-sm">
        <div class="card-header bg-warning">All FASTag Records</div>
        <div class="card-body">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Tag ID</th>
                        <th>Name</th>
                        <th>Reg No</th>
                        <th>Mobile</th>
                        <th>Unit</th>
                        <th>Others</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="f : ${fastags}">
                        <td th:text="${f.tagId}"></td>
                        <td th:text="${f.name}"></td>
                        <td th:text="${f.regNo}"></td>
                        <td th:text="${f.mobileNumber}"></td>
                        <td th:text="${f.unitNo}"></td>
                        <td th:text="${f.others}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const socket = new SockJS('/ws');
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, function () {
            console.log("âœ… Connected to WebSocket");

            stompClient.subscribe('/topic/scans', function (message) {
                const data = JSON.parse(message.body);
                console.log("ðŸ“Œ Data received:", data);

                // UI update karo
                document.getElementById("scanTagId").innerText = data.tagId || "-";
                document.getElementById("scanName").innerText = data.name || "-";
                document.getElementById("scanReg").innerText = data.regNo || "-";
                document.getElementById("scanMobile").innerText = data.mobileNumber || "-";
                document.getElementById("scanUnit").innerText = data.unitNo || "-";
                document.getElementById("scanOther").innerText = data.others || "-";
            });
        });
    });
</script>
</body>
</html>
